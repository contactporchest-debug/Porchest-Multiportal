# Facebook OAuth Connection Troubleshooting Guide

## Common Error: "No Facebook pages found"

This error occurs when connecting your Instagram Business Account through Facebook OAuth. Here's how to fix it:

### Prerequisites Checklist

Before connecting, ensure you have:

1. ✅ **Facebook Account** - You need a personal Facebook account
2. ✅ **Facebook Page** - You must create or manage at least one Facebook Page
3. ✅ **Instagram Business/Creator Account** - Your Instagram must be a Business or Creator account (not Personal)
4. ✅ **Linked Accounts** - Your Instagram Business Account must be linked to your Facebook Page
5. ✅ **Admin Access** - You must have admin access to the Facebook Page

---

## Step-by-Step Setup Guide

### Step 1: Create a Facebook Page (If you don't have one)

1. Go to [facebook.com/pages/create](https://www.facebook.com/pages/create)
2. Choose a page type (Business, Community, etc.)
3. Enter your page name and category
4. Complete the setup wizard

**Important:** You don't need a business or have real content on this page. It's simply a connector between Facebook and Instagram.

---

### Step 2: Convert Instagram to Business/Creator Account

1. Open Instagram app on your phone
2. Go to **Settings → Account**
3. Tap **Switch to Professional Account**
4. Choose **Business** or **Creator**
5. Complete the setup process

**Note:** If you already have a Business/Creator account, skip this step.

---

### Step 3: Link Instagram to Facebook Page

This is the **most critical step** where most users face issues:

#### Option A: Link from Instagram App
1. Open Instagram app
2. Go to **Settings → Account → Linked Accounts**
3. Tap **Facebook**
4. Choose your Facebook Page from the list
5. Complete the connection

#### Option B: Link from Facebook Page Settings
1. Go to [facebook.com](https://www.facebook.com)
2. Navigate to your Facebook Page
3. Click **Settings** (in left sidebar)
4. Click **Instagram** tab
5. Click **Connect Account**
6. Follow the prompts to link your Instagram account

---

### Step 4: Verify the Connection

Before connecting on Porchest:

1. Go to your Facebook Page
2. Navigate to **Settings → Instagram**
3. You should see your Instagram username listed as "Connected"

---

### Step 5: Grant Permissions During OAuth

When connecting on Porchest, Facebook will ask for several permissions:

- ✅ **pages_show_list** - See your Facebook Pages
- ✅ **instagram_basic** - Access basic Instagram info
- ✅ **instagram_manage_insights** - Read Instagram analytics
- ✅ **pages_read_engagement** - Read Page engagement data
- ✅ **business_management** - Manage business assets
- ✅ **public_profile** - Access your public profile

**IMPORTANT:** You must click "Allow" or "Continue" for ALL requested permissions. If you deny any permission, the connection will fail.

---

## Troubleshooting Common Issues

### Issue 1: "No Facebook pages found"

**Causes:**
- You don't have a Facebook Page yet
- You denied the `pages_show_list` permission during OAuth
- Your Facebook account doesn't have admin access to any pages

**Solutions:**
1. Create a Facebook Page (Step 1 above)
2. Reconnect and allow all permissions
3. Make sure you're logged into the correct Facebook account

---

### Issue 2: "No Instagram Business Account found"

**Causes:**
- Your Instagram is still a Personal account
- Instagram is not linked to your Facebook Page
- The link broke or expired

**Solutions:**
1. Convert to Business/Creator account (Step 2 above)
2. Link Instagram to Facebook Page (Step 3 above)
3. Verify the connection before trying again

---

### Issue 3: "Missing permissions: ..."

**Cause:**
- You denied one or more permissions during OAuth flow

**Solution:**
1. Go to [facebook.com/settings?tab=business_tools](https://www.facebook.com/settings?tab=business_tools)
2. Find "Porchest" in the list
3. Click "Remove"
4. Try connecting again and allow ALL permissions

---

### Issue 4: Connection works but no metrics show

**Causes:**
- Instagram account is too new (< 24 hours)
- Instagram Business Account doesn't have enough posts yet
- Insights haven't been generated by Instagram yet

**Solutions:**
1. Wait 24-48 hours after converting to Business account
2. Post some content if your account is empty
3. Use the "Sync Metrics" button to refresh data

---

## Quick Checklist Before Connecting

Run through this checklist:

- [ ] I have a Facebook Page
- [ ] I'm an admin of the Facebook Page
- [ ] My Instagram is a Business or Creator account
- [ ] My Instagram is linked to my Facebook Page (verified in Facebook Page settings)
- [ ] I'm logged into the correct Facebook account
- [ ] I will allow ALL permissions when connecting

---

## Still Having Issues?

If you've followed all steps and still can't connect:

1. **Check Server Logs** - Look for detailed error messages in the console logs
2. **Verify Facebook App Settings** - Ensure the Facebook App has the correct OAuth redirect URI configured
3. **Test with Different Browser** - Try connecting in incognito mode or different browser
4. **Clear Cookies** - Clear browser cookies and cache
5. **Contact Support** - Reach out with your error message and user ID

---

## For Developers

### Environment Variables Required

```env
META_APP_ID=your-facebook-app-id
META_APP_SECRET=your-facebook-app-secret
META_REDIRECT_URI=https://your-domain.com/api/meta/callback
```

### Facebook App Configuration

1. Create app at [developers.facebook.com](https://developers.facebook.com)
2. Add **Facebook Login** product
3. Configure OAuth redirect URI: `https://your-domain.com/api/meta/callback`
4. Request permissions in App Review (for production):
   - instagram_basic
   - instagram_manage_insights
   - pages_show_list
   - pages_read_engagement
   - business_management

### Testing in Development Mode

Facebook apps in Development Mode can only be accessed by:
- App admins
- App developers
- App testers

Add test users in **Roles → Test Users** section of your Facebook App.

---

## API Response Examples

### Successful Connection
```json
{
  "success": true,
  "data": {
    "profile": { ... },
    "instagram_account": {
      "username": "your_username",
      "is_connected": true,
      "last_synced_at": "2025-11-21T05:00:00.000Z"
    },
    "instagram_metrics": { ... },
    "calculated_metrics": { ... }
  }
}
```

### Failed Connection - No Pages
```json
{
  "success": false,
  "error": {
    "message": "No Facebook pages found. You need to create a Facebook Page first...",
    "code": "NO_FACEBOOK_PAGES"
  }
}
```

### Failed Connection - Missing Permissions
```json
{
  "success": false,
  "error": {
    "message": "Missing permissions: pages_show_list. Please reconnect and allow all requested permissions.",
    "code": "MISSING_PERMISSIONS"
  }
}
```

---

## Additional Resources

- [Facebook Pages Help](https://www.facebook.com/business/help/898752960195806)
- [Instagram Business Account Setup](https://help.instagram.com/502981923235522)
- [Link Instagram to Facebook Page](https://www.facebook.com/business/help/connect-instagram-to-page)
- [Facebook Graph API Documentation](https://developers.facebook.com/docs/graph-api)
- [Instagram Basic Display API](https://developers.facebook.com/docs/instagram-basic-display-api)

---

**Last Updated:** 2025-11-21
